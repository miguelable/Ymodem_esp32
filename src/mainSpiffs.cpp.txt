#include <Arduino.h>
#include <SPIFFS.h>

void setup()
{
  // Inicialización de Serial para depuración
  Serial.begin(115200);
  while (!Serial) {
    ; // Espera hasta que Serial esté listo
  }

  // Inicialización de SPIFFS
  if (!SPIFFS.begin(true)) {
    Serial.println("Error al montar SPIFFS");
    return;
  }

  // Listar los archivos en SPIFFS
  Serial.println("Archivos en SPIFFS:");
  File root = SPIFFS.open("/");
  File file = root.openNextFile();
  while (file) {
    Serial.print("Nombre: ");
    Serial.println(file.name());

    // Leer y mostrar los primeros 100 caracteres del archivo
    Serial.print("Contenido: ");
    char buffer[101];                                // Buffer para almacenar los caracteres leídos
    int  bytesRead    = file.readBytes(buffer, 100); // Leer hasta 100 caracteres
    buffer[bytesRead] = '\0';                        // Asegurarse de que el buffer esté terminado en nulo
    Serial.println(buffer);

    file = root.openNextFile();
  }

  // Eliminar todos los archivos en SPIFFS
  root = SPIFFS.open("/");
  file = root.openNextFile();
  while (file) {
    const char* fileName = file.name();
    if (fileName && strlen(fileName) > 0) {
      Serial.print("Eliminando archivo: ");
      Serial.println(fileName);
      if (SPIFFS.remove(String("/") + fileName)) {
        Serial.println("Archivo eliminado exitosamente");
      }
      else {
        Serial.println("Error al eliminar el archivo");
      }
    }
    else {
      Serial.println("Nombre de archivo no válido");
    }
    file = root.openNextFile();
  }

  // Listar los archivos en SPIFFS después de la eliminación
  Serial.println("Archivos en SPIFFS después de la eliminación:");
  root = SPIFFS.open("/");
  file = root.openNextFile();
  while (file) {
    Serial.print("Nombre: ");
    Serial.println(file.name());
    file = root.openNextFile();
  }
}

void loop()
{
  // No se necesita código en el loop para esta operación
}