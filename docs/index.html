<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ymodem ESP32: Ymodem ESP32</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Ymodem ESP32<span id="projectnumber">&#160;1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="classYmodem.html" title="Ymodem class.">Ymodem</a> ESP32 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> <a class="el" href="classYmodem.html" title="Ymodem class.">Ymodem</a> library for ESP32 with Arduino Framework</p>
<h3><a class="anchor" id="autotoc_md0"></a>
Overview</h3>
<p>The <a class="el" href="classYmodem.html" title="Ymodem class.">Ymodem</a> library provides an implementation of the <a class="el" href="classYmodem.html" title="Ymodem class.">Ymodem</a> protocol for file transfer over serial communication. It is designed to work with the ESP32 microcontroller and the Arduino framework. This library allows you to send and receive files using the <a class="el" href="classYmodem.html" title="Ymodem class.">Ymodem</a> protocol, which is commonly used for reliable file transfers in embedded systems.</p>
<h3><a class="anchor" id="autotoc_md1"></a>
Features</h3>
<ul>
<li><b>File Transmission and Reception</b>: Supports sending and receiving files using the <a class="el" href="classYmodem.html" title="Ymodem class.">Ymodem</a> protocol.</li>
<li><b>SPIFFS Integration</b>: Works seamlessly with the SPIFFS filesystem on the ESP32.</li>
<li><b>Serial Communication</b>: Utilizes the hardware serial ports of the ESP32 for data transfer.</li>
<li><b>Error Handling</b>: Includes error detection and handling mechanisms to ensure reliable file transfers.</li>
<li><b>Configurable</b>: Allows customization of various parameters such as baud rate, file size limits, and more.</li>
</ul>
<h3><a class="anchor" id="autotoc_md2"></a>
Installation</h3>
<ol type="1">
<li>Download the <a class="el" href="classYmodem.html" title="Ymodem class.">Ymodem</a> library and place it in the lib directory of your PlatformIO project.</li>
<li>Ensure that the platformio.ini file includes the necessary dependencies for the ESP32 and SPIFFS.</li>
</ol>
<h3><a class="anchor" id="autotoc_md3"></a>
Usage</h3>
<h4><a class="anchor" id="autotoc_md4"></a>
Transmitting a File</h4>
<p>To transmit a file using the <a class="el" href="classYmodem.html" title="Ymodem class.">Ymodem</a> protocol, follow these steps:</p>
<ol type="1">
<li>Include the necessary headers in your source file:</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="YmodemCore_8h.html">YmodemCore.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Arduino.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;HardwareSerial.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;SPIFFS.h&gt;</span></div>
<div class="ttc" id="aYmodemCore_8h_html"><div class="ttname"><a href="YmodemCore_8h.html">YmodemCore.h</a></div><div class="ttdoc">Ymodem core functions.</div></div>
</div><!-- fragment --><ol type="1">
<li>Define the SPIFFS size and maximum file size:</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#define CONFIG_SPIFFS_SIZE (2 * 1024 * 1024)        </span></div>
<div class="line"><span class="preprocessor">#define MAX_FILE_SIZE (CONFIG_SPIFFS_SIZE - 0x2000) </span></div>
</div><!-- fragment --><ol type="1">
<li>Create an instance of the <a class="el" href="classYmodem.html" title="Ymodem class.">Ymodem</a> class:</li>
</ol>
<div class="fragment"><div class="line"><a class="code hl_class" href="classYmodem.html">Ymodem</a> <a class="code hl_variable" href="ReceiveExample_8cpp.html#a76f39e389d30fc6ab2a71a1637906106">ymodem</a>;</div>
<div class="ttc" id="aReceiveExample_8cpp_html_a76f39e389d30fc6ab2a71a1637906106"><div class="ttname"><a href="ReceiveExample_8cpp.html#a76f39e389d30fc6ab2a71a1637906106">ymodem</a></div><div class="ttdeci">Ymodem ymodem</div><div class="ttdef"><b>Definition</b> <a href="ReceiveExample_8cpp_source.html#l00023">ReceiveExample.cpp:23</a></div></div>
<div class="ttc" id="aclassYmodem_html"><div class="ttname"><a href="classYmodem.html">Ymodem</a></div><div class="ttdoc">Ymodem class.</div><div class="ttdef"><b>Definition</b> <a href="YmodemCore_8h_source.html#l00029">YmodemCore.h:30</a></div></div>
</div><!-- fragment --><ol type="1">
<li>Initialize the system and configure the serial communication and SPIFFS filesystem in the setup function:</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="readSpiffs_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a>() {</div>
<div class="line">    Serial.begin(115200);</div>
<div class="line">    <span class="keywordflow">while</span> (!Serial) {</div>
<div class="line">        ; <span class="comment">// Wait for Serial to be ready</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!SPIFFS.begin(<span class="keyword">true</span>)) {</div>
<div class="line">        Serial.println(<span class="stringliteral">&quot;SPIFFS Mount Failed&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    Serial1.begin(115200, SERIAL_8N1, RX_PIN, TX_PIN);</div>
<div class="line">    pinMode(LED_PIN, OUTPUT);</div>
<div class="line">    Serial.println(<span class="stringliteral">&quot;Setup complete. Ready to send files.&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="areadSpiffs_8cpp_html_a4fc01d736fe50cf5b977f755b675f11d"><div class="ttname"><a href="readSpiffs_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a></div><div class="ttdeci">void setup()</div><div class="ttdoc">Setup function for initializing Serial communication and SPIFFS.</div><div class="ttdef"><b>Definition</b> <a href="readSpiffs_8cpp_source.html#l00042">readSpiffs.cpp:42</a></div></div>
</div><!-- fragment --><ol type="1">
<li>Implement the file transmission logic in the loop function or another appropriate function:</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="readSpiffs_8cpp.html#afe461d27b9c48d5921c00d521181f12f">loop</a>() {</div>
<div class="line">    File file = SPIFFS.open(<span class="stringliteral">&quot;/example.txt&quot;</span>, FILE_READ);</div>
<div class="line">    <span class="keywordflow">if</span> (!file) {</div>
<div class="line">        Serial.println(<span class="stringliteral">&quot;Failed to open file for reading&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> result = <a class="code hl_variable" href="ReceiveExample_8cpp.html#a76f39e389d30fc6ab2a71a1637906106">ymodem</a>.<a class="code hl_function" href="classYmodem.html#af88a1bb1d78619e3f8efd166e95428d1">transmit</a>(<span class="stringliteral">&quot;example.txt&quot;</span>, file.size(), file);</div>
<div class="line">    <span class="keywordflow">if</span> (result == 0) {</div>
<div class="line">        Serial.println(<span class="stringliteral">&quot;File transmitted successfully&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        Serial.printf(<span class="stringliteral">&quot;File transmission failed with error code: %d\n&quot;</span>, result);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    file.close();</div>
<div class="line">    delay(10000); <span class="comment">// Wait before sending the file again</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassYmodem_html_af88a1bb1d78619e3f8efd166e95428d1"><div class="ttname"><a href="classYmodem.html#af88a1bb1d78619e3f8efd166e95428d1">Ymodem::transmit</a></div><div class="ttdeci">int transmit(char *sendFileName, unsigned int sizeFile, fs::File &amp;ffd)</div><div class="ttdoc">Transmits a file using the Ymodem protocol.</div><div class="ttdef"><b>Definition</b> <a href="YmodemCore_8cpp_source.html#l00069">YmodemCore.cpp:69</a></div></div>
<div class="ttc" id="areadSpiffs_8cpp_html_afe461d27b9c48d5921c00d521181f12f"><div class="ttname"><a href="readSpiffs_8cpp.html#afe461d27b9c48d5921c00d521181f12f">loop</a></div><div class="ttdeci">void loop()</div><div class="ttdoc">Main loop function.</div><div class="ttdef"><b>Definition</b> <a href="readSpiffs_8cpp_source.html#l00115">readSpiffs.cpp:115</a></div></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md5"></a>
Receiving a File</h4>
<p>To receive a file using the <a class="el" href="classYmodem.html" title="Ymodem class.">Ymodem</a> protocol, follow these steps:</p>
<ol type="1">
<li>Include the necessary headers in your source file:</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="YmodemCore_8h.html">YmodemCore.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Arduino.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;HardwareSerial.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;SPIFFS.h&gt;</span></div>
</div><!-- fragment --><ol type="1">
<li>Define the SPIFFS size and maximum file size:</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#define CONFIG_SPIFFS_SIZE (2 * 1024 * 1024)        </span></div>
<div class="line"><span class="preprocessor">#define MAX_FILE_SIZE (CONFIG_SPIFFS_SIZE - 0x2000) </span></div>
</div><!-- fragment --><ol type="1">
<li>Create an instance of the <a class="el" href="classYmodem.html" title="Ymodem class.">Ymodem</a> class:</li>
</ol>
<div class="fragment"><div class="line"><a class="code hl_class" href="classYmodem.html">Ymodem</a> <a class="code hl_variable" href="ReceiveExample_8cpp.html#a76f39e389d30fc6ab2a71a1637906106">ymodem</a>;</div>
</div><!-- fragment --><ol type="1">
<li>Initialize the system and configure the serial communication and SPIFFS filesystem in the setup function:</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="readSpiffs_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a>() {</div>
<div class="line">    Serial.begin(115200);</div>
<div class="line">    <span class="keywordflow">while</span> (!Serial) {</div>
<div class="line">        ; <span class="comment">// Wait for Serial to be ready</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!SPIFFS.begin(<span class="keyword">true</span>)) {</div>
<div class="line">        Serial.println(<span class="stringliteral">&quot;SPIFFS Mount Failed&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    Serial1.begin(115200, SERIAL_8N1, RX_PIN, TX_PIN);</div>
<div class="line">    pinMode(LED_PIN, OUTPUT);</div>
<div class="line">    Serial.println(<span class="stringliteral">&quot;Setup complete. Ready to receive files.&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><ol type="1">
<li>Implement the file reception logic in the loop function or another appropriate function:</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="readSpiffs_8cpp.html#afe461d27b9c48d5921c00d521181f12f">loop</a>() {</div>
<div class="line">    File file = SPIFFS.open(<span class="stringliteral">&quot;/received.txt&quot;</span>, FILE_WRITE);</div>
<div class="line">    <span class="keywordflow">if</span> (!file) {</div>
<div class="line">        Serial.println(<span class="stringliteral">&quot;Failed to open file for writing&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> fileName[64];</div>
<div class="line">    <span class="keywordtype">int</span> result = <a class="code hl_variable" href="ReceiveExample_8cpp.html#a76f39e389d30fc6ab2a71a1637906106">ymodem</a>.<a class="code hl_function" href="classYmodem.html#aa576a7a73f33988130eb58c2bcecc80c">receive</a>(file, <a class="code hl_define" href="ReceiveExample_8cpp.html#a649ad5274d988d17a275a3cead056746">MAX_FILE_SIZE</a>, fileName);</div>
<div class="line">    <span class="keywordflow">if</span> (result == 0) {</div>
<div class="line">        Serial.println(<span class="stringliteral">&quot;File received successfully&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        Serial.printf(<span class="stringliteral">&quot;File reception failed with error code: %d\n&quot;</span>, result);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    file.close();</div>
<div class="line">    delay(10000); <span class="comment">// Wait before receiving the file again</span></div>
<div class="line">}</div>
<div class="ttc" id="aReceiveExample_8cpp_html_a649ad5274d988d17a275a3cead056746"><div class="ttname"><a href="ReceiveExample_8cpp.html#a649ad5274d988d17a275a3cead056746">MAX_FILE_SIZE</a></div><div class="ttdeci">#define MAX_FILE_SIZE</div><div class="ttdef"><b>Definition</b> <a href="ReceiveExample_8cpp_source.html#l00020">ReceiveExample.cpp:20</a></div></div>
<div class="ttc" id="aclassYmodem_html_aa576a7a73f33988130eb58c2bcecc80c"><div class="ttname"><a href="classYmodem.html#aa576a7a73f33988130eb58c2bcecc80c">Ymodem::receive</a></div><div class="ttdeci">int receive(fs::File &amp;ffd, unsigned int maxsize, char *getname)</div><div class="ttdoc">Receives data and writes it to the provided file.</div><div class="ttdef"><b>Definition</b> <a href="YmodemCore_8cpp_source.html#l00051">YmodemCore.cpp:51</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Error Codes</h2>
<p>The <a class="el" href="classYmodem.html" title="Ymodem class.">Ymodem</a> library provides the following error codes for file transmission and reception:</p>
<ul>
<li>-1: Abort by sender</li>
<li>-2: Too many errors</li>
<li>-3: Packet sequence error</li>
<li>-4: Invalid file size</li>
<li>-5: Filename packet error</li>
<li>-6: File write error</li>
<li>-7: User abort</li>
<li>-8: Timeout</li>
<li>-9: File size exceeds maxsize</li>
</ul>
<h3><a class="anchor" id="autotoc_md7"></a>
License</h3>
<p>This library is licensed under the MIT License. See the LICENSE file for more information.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Acknowledgements</h3>
<p>This library is based on the <a class="el" href="classYmodem.html" title="Ymodem class.">Ymodem</a> C implementation by <a href="https://gist.github.com/zonque/0ae2dc8cedbcdbd9b933">zonque</a> and has been adapted for the ESP32 microcontroller with the Arduino framework. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
